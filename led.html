<!doctype html>
<html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>LED controller</title>

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

        <script   src="https://code.jquery.com/jquery-2.2.3.min.js"   integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo="   crossorigin="anonymous"></script>

        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/7.0.2/css/bootstrap-slider.min.css">

        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/7.0.2/bootstrap-slider.min.js"></script>

        <script src="/static/led.js" type="text/javascript"></script>
        <script type="text/javascript">
        window.onload = function () {
            var slider = new Slider('#ex1', {
                formatter: function(value) {
                    return 'Brightness: ' + value;
                }
            });

            slider.on("slide", function(slideEvt) {
                //$("#ex6SliderVal").text(slideEvt.value);
                //console.log(slideEvt)
                var obj = {0: slideEvt}
                tosend = JSON.stringify(obj);
                console.log(tosend)
                ws.send(tosend);
            });

            // assigning onchange event handler
            
        };

        slider.slide = function (clr) {
                var confus;
                var red = slider.getValue()*40;
                var obj = {0: red}
                confus = JSON.stringify(obj);
                console.log(confus)
                ws.send(confus);
            };
        // Convert rgb values 0, 1, 2 to hex
        function componentToHex(c) {
            var hex = c.toString(16);
            return hex.length == 1 ? "0" + hex : hex;
        };

        function rgbToHex(r, g, b) {
            return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
        };

        // Websockets
        var ws = null;
        function init(colors) {
            if ("WebSocket" in window) {
                ws = new WebSocket("ws://" + location.hostname + "/ws");
                ws.onopen = function() {
                    console.log("Connection is opened");
                }
                ws.onclose = function() {
                    console.log("Connection is closed");
                }
                ws.onmessage = function(msg, colors) {
                    //document.getElementById("display").innerHTML = msg.data;

                    // Converting received color information into hex
                    //colors = JSON.parse(msg.data)
                    //hex = rgbToHex(colors[0]/16, colors[1]/16, colors[2]/16)
                    //console.log(hex)
                    //document.body.style.backgroundColor = hex;
                }    
            } else {
                console.log('Your browser doenst support WebSocket!')
            }
        }
        </script>   
        <style>
        .leftright {
            margin: 20px;
        }

        #ex1Slider .slider-selection {
            background: #BABABA;
        }

        .slider.slider-horizontal {
            width: 100%;
        }

        </style>
    </head>
    <body onload="init();">

    <div class="container">
    <h1 style="font-size: 3.5em; margin-top: 50px">Eclairage gare <span class="label label-success">Le Sépey</span></h1>
<div style="height: 100vh; display: flex; align-content: center">
<div>
    <div class="row" style="margin-top: 40px;">
        <div class="well col-md-3 leftright" style="background-color: #dff0d8; text-align: center">
            <font style="font-size: 2.5em; color: #2e7d32; font-weight: 700;">1.35 KwH</font><br>
            <font style="font-size: 1em; color: #2e7d32;">mai 2016</font>
        </div>
        <div class="well col-md-3 leftright" style="text-align: center">
            <font style="font-size: 2.5em; font-weight: 700;">18 trains</font><br>
            <font style="font-size: 1em; ">aujourd'hui</font>
        </div>
        <div class="well col-md-3 leftright" style="text-align: center">
            <font style="font-size: 2.5em; font-weight: 700;">15 minutes</font><br>
            <span class="label label-success">-22%</span><font style="font-size: 1em; ">  par rapport a hier</font>
        </div>
        </div>

        <div style="height: 80px; background-color: #5cb85c; margin-left: 0; width: 85%">

        <div class="container" style="display: flex; align-content: center; justify-content: center">
        <h1 style="margin-left: -220px; color: white; margin-bottom: 25px"><span style="color: #dcedc8; font-size: 0.8em">PROCHAIN TRAIN DANS</span> 47 minutes</h1>
        </div ></div>
        </div>
</div>
<div>
<p style="color: grey; margin-top: 20px; width: 85%">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
<a class="btn btn-default btn-xl" role="button" data-toggle="collapse" href="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
  Parametres
</a>
<br>
<div class="collapse" id="collapseExample">
  <div style="background-color: #f1f8e9; height: 200px; margin-top: 10px; width: 85%">
    <div class="well col-md-6 leftright">
        <h3 style="margin-top: 0px">Luminosité</h3>
        <input id="ex1" data-slider-id='ex1Slider' type="text" data-slider-min="0" data-slider-max="4096" data-slider-step="1" data-slider-value="3000"/>
    </div>
    <a style="margin-left: 20px" id="myButton" class="btn btn-default col-md-6" role="button">
  Test
</a>
<a style="margin-left: 20px" id="off" class="btn btn-success col-md-1" role="button">
  Off
</a>
    </div>

  </div>
</div>
        
    </div>
    </div>
<div style="height: 100px">
<script>
function sleep(milliseconds) {
  var start = new Date().getTime();
  for (var i = 0; i < 1e7; i++) {
    if ((new Date().getTime() - start) > milliseconds){
      break;
    }
  }
}

$('#myButton').on('click', function () {
    for (i = 1; i < 100; i++) { 
        var obj = {0: i}
        confus = JSON.stringify(obj);
        console.log(confus)
        ws.send(confus);
        sleep(10);
    }
})

$('#off').on('click', function () {
    for (i = 100; i < 1; i++) { 
        var obj = {0: i}
        confus = JSON.stringify(obj);
        console.log(confus)
        ws.send(confus);
        sleep(10);
    }
})
</script>
    </body>
</html>

