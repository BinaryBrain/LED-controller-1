<!doctype html>
<html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>LED controller</title>

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/7.0.2/css/bootstrap-slider.min.css">

        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/7.0.2/bootstrap-slider.min.js"></script>

        <script type="text/javascript">
        window.onload = function () {
            var slider = new Slider('#ex1', {
                formatter: function(value) {
                    return 'Brightness: ' + value;
                }
            });

            slider.on("slide", function(slideEvt) {
                //$("#ex6SliderVal").text(slideEvt.value);
                //console.log(slideEvt)
                var obj = {0: slideEvt}
                tosend = JSON.stringify(obj);
                console.log(tosend)
                ws.send(tosend);
            });            
        };

        // Websockets
        var ws = null;
        function init(colors) {
            if ("WebSocket" in window) {
                ws = new WebSocket("ws://" + location.hostname + "/ws");
                ws.onopen = function() {
                    document.getElementById("status").innerHTML = "connection open";
                    console.log("Connection is opened");
                }
                ws.onclose = function() {
                    document.getElementById("status").innerHTML = "websockets disconnected";
                    console.log("Connection is closed");
                }
                ws.onmessage = function(msg, colors) {
                    document.getElementById("status").innerHTML = msg.data;
                }    
            } else {
                document.getElementById("status").innerHTML = "no browser websockets support";
                console.log('Your browser doenst support WebSocket!')
            }
        }
        </script>   
        <style>
        .leftright {
            margin: 20px;
        }

        #ex1Slider .slider-selection {
            background: #BABABA;
        }

        .slider.slider-horizontal {
            width: 100%;
        }

        </style>
    </head>

    <body onload="init();">
    <div class="leftright">
        <h3 style="margin-top: 0px">Brightness</h3>
        <input id="ex1" data-slider-id='ex1Slider' type="text" data-slider-min="0" data-slider-max="4096" data-slider-step="1" data-slider-value="3000"/>
        <p id="status">waiting to connect</p>
        <a id="myButton" role="button">On</a>
        <a id="off" role="button">Off</a>
    </div>

<script>
function sleep(milliseconds) {
  var start = new Date().getTime();
  for (var i = 0; i < 1e7; i++) {
    if ((new Date().getTime() - start) > milliseconds){
      break;
    }
  }
}

$('#myButton').on('click', function () {
    for (i = 1; i < 100; i++) { 
        var obj = {0: i}
        confus = JSON.stringify(obj);
        console.log(confus)
        ws.send(confus);
        sleep(10);
    }
})

$('#off').on('click', function () {
    for (i = 100; i < 1; i++) { 
        var obj = {0: i}
        confus = JSON.stringify(obj);
        console.log(confus)
        ws.send(confus);
        sleep(10);
    }
})
</script>
    </body>
</html>

