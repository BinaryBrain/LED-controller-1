<!doctype html>
<html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>LED controller</title>

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/7.0.2/css/bootstrap-slider.min.css">

        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/7.0.2/bootstrap-slider.min.js"></script>

        <script type="text/javascript">
        window.onload = function () {
            var slider = new Slider('#ex1', {
                formatter: function(value) {
                    return 'Brightness: ' + value;
                }
            });

            slider.on("slide", function(slideEvt) {
                //$("#ex6SliderVal").text(slideEvt.value);
                //console.log(slideEvt)
                var obj = {0: slideEvt}
                tosend = JSON.stringify(obj);
                console.log(tosend)
                ws.send(tosend);
            });

            // assigning onchange event handler
            
        };

        slider.slide = function (clr) {
                var confus;
                var red = slider.getValue()*40;
                var obj = {0: red}
                confus = JSON.stringify(obj);
                console.log(confus)
                ws.send(confus);
            };
        // Convert rgb values 0, 1, 2 to hex
        function componentToHex(c) {
            var hex = c.toString(16);
            return hex.length == 1 ? "0" + hex : hex;
        };

        function rgbToHex(r, g, b) {
            return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
        };

        // Websockets
        var ws = null;
        function init(colors) {
            if ("WebSocket" in window) {
                ws = new WebSocket("ws://" + location.hostname + "/ws");
                ws.onopen = function() {
                    console.log("Connection is opened");
                }
                ws.onclose = function() {
                    console.log("Connection is closed");
                }
                ws.onmessage = function(msg, colors) {
                    //document.getElementById("display").innerHTML = msg.data;

                    // Converting received color information into hex
                    //colors = JSON.parse(msg.data)
                    //hex = rgbToHex(colors[0]/16, colors[1]/16, colors[2]/16)
                    //console.log(hex)
                    //document.body.style.backgroundColor = hex;
                }    
            } else {
                console.log('Your browser doenst support WebSocket!')
            }
        }
        </script>   
        <style>
        .leftright {
            margin: 20px;
        }

        #ex1Slider .slider-selection {
            background: #BABABA;
        }

        .slider.slider-horizontal {
            width: 100%;
        }

        </style>
    </head>
    <body onload="init();">
    <div class="well col-md-6 leftright">
        <h3 style="margin-top: 0px">Luminosit√©</h3>
        <input id="ex1" data-slider-id='ex1Slider' type="text" data-slider-min="0" data-slider-max="4096" data-slider-step="1" data-slider-value="3000"/>
    </div>
    <a style="margin-left: 20px" id="myButton" class="btn btn-default col-md-6" role="button">
  Test
</a>
<a style="margin-left: 20px" id="off" class="btn btn-success col-md-1" role="button">
  Off
</a>
    </div>

  </div>
</div>
        
    </div>
    </div>
<div style="height: 100px">
<script>
function sleep(milliseconds) {
  var start = new Date().getTime();
  for (var i = 0; i < 1e7; i++) {
    if ((new Date().getTime() - start) > milliseconds){
      break;
    }
  }
}

$('#myButton').on('click', function () {
    for (i = 1; i < 100; i++) { 
        var obj = {0: i}
        confus = JSON.stringify(obj);
        console.log(confus)
        ws.send(confus);
        sleep(10);
    }
})

$('#off').on('click', function () {
    for (i = 100; i < 1; i++) { 
        var obj = {0: i}
        confus = JSON.stringify(obj);
        console.log(confus)
        ws.send(confus);
        sleep(10);
    }
})
</script>
    </body>
</html>

